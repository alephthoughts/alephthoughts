<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Abhishek">
<meta name="dcterms.date" content="2023-05-17">
<meta name="description" content="An experimental language for data.">

<title>alephthoughts - Optimizing Your Data Analysis with Malloy</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-116353462-1', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script>
<style>

      .quarto-title-block .quarto-title-banner h1,
      .quarto-title-block .quarto-title-banner h2,
      .quarto-title-block .quarto-title-banner h3,
      .quarto-title-block .quarto-title-banner h4,
      .quarto-title-block .quarto-title-banner h5,
      .quarto-title-block .quarto-title-banner h6
      {
        color: #FFFFFF;
      }

      .quarto-title-block .quarto-title-banner {
        color: #FFFFFF;
background-image: url(../banner.png);
background-size: cover;
      }
</style>


<link rel="stylesheet" href="../../../styles.css">
<meta property="og:title" content="alephthoughts - Optimizing Your Data Analysis with Malloy">
<meta property="og:description" content="An experimental language for data.">
<meta property="og:image" content="https://alephthoughts.com/thoughts/posts/data-engineering/malloy-logo.png">
<meta property="og:site-name" content="alephthoughts">
<meta property="og:image:height" content="200">
<meta property="og:image:width" content="200">
<meta name="twitter:title" content="alephthoughts - Optimizing Your Data Analysis with Malloy">
<meta name="twitter:description" content="An experimental language for data.">
<meta name="twitter:image" content="https://alephthoughts.com/thoughts/posts/data-engineering/malloy-logo.png">
<meta name="twitter:creator" content="@alephthoughts">
<meta name="twitter:image-height" content="200">
<meta name="twitter:image-width" content="200">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../../quarto.png" alt="" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../thoughts/" rel="" target="">
 <span class="menu-text">Thoughts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../now.html" rel="" target="">
 <span class="menu-text">Now</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Optimizing Your Data Analysis with Malloy</h1>
                  <div>
        <div class="description">
          An experimental language for data.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">tools</div>
                <div class="quarto-category">data engineering</div>
                <div class="quarto-category">malloy</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Abhishek </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">May 17, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#the-shift-in-data-management" id="toc-the-shift-in-data-management" class="nav-link active" data-scroll-target="#the-shift-in-data-management">The Shift in Data Management</a></li>
  <li><a href="#the-limitations-of-traditional-data-warehousing-and-sql" id="toc-the-limitations-of-traditional-data-warehousing-and-sql" class="nav-link" data-scroll-target="#the-limitations-of-traditional-data-warehousing-and-sql">The Limitations of Traditional Data Warehousing and SQL</a>
  <ul class="collapse">
  <li><a href="#sql-templates" id="toc-sql-templates" class="nav-link" data-scroll-target="#sql-templates">SQL Templates</a></li>
  <li><a href="#data-warehouse-schema-design" id="toc-data-warehouse-schema-design" class="nav-link" data-scroll-target="#data-warehouse-schema-design">Data Warehouse Schema Design</a></li>
  </ul></li>
  <li><a href="#introducing-malloy---an-experimental-language-for-data" id="toc-introducing-malloy---an-experimental-language-for-data" class="nav-link" data-scroll-target="#introducing-malloy---an-experimental-language-for-data">Introducing Malloy - An experimental language for data</a>
  <ul class="collapse">
  <li><a href="#dimensional-freedom" id="toc-dimensional-freedom" class="nav-link" data-scroll-target="#dimensional-freedom">Dimensional Freedom</a>
  <ul class="collapse">
  <li><a href="#source" id="toc-source" class="nav-link" data-scroll-target="#source">Source</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#malloys-features" id="toc-malloys-features" class="nav-link" data-scroll-target="#malloys-features">Malloyâ€™s Features</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>If youâ€™re someone who doesnâ€™t often write SQL, parts of this discussion may seem complex. However, if youâ€™re involved in data management, building interfaces, or working with databases, this blog post will prove insightful.</p>
</div>
</div>
<section id="the-shift-in-data-management" class="level1">
<h1>The Shift in Data Management</h1>
<p>Data is a crucial part of all organizations, and itâ€™s only when data is understood and utilised correctly, the businesses can truly thrive. Running a successful business today depends on the data and insights derived from it that make you smarter. A common misconception that surrounds data is that <em>data is rectangular</em>. That is, in fact, not true. Humans tend to visualize data as rectangles than leads to this misconception. Most operations that we perform on data such as filtering, aggregating, projecting, and windowing are all based on rectangular models. Even the join operation takes in two rectangles and gives a rectangle as the joined output.</p>
<p>In a common ecommerce analysis you can expect two tables:</p>
<p><strong>Orders</strong></p>
<table class="table">
<thead>
<tr class="header">
<th>order_id</th>
<th>order_date</th>
<th>shipping_cost</th>
<th>user_id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2022-01-01</td>
<td>2</td>
<td>1</td>
</tr>
<tr class="even">
<td>2</td>
<td>2022-01-01</td>
<td>3</td>
<td>2</td>
</tr>
<tr class="odd">
<td>3</td>
<td>2022-01-02</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td>4</td>
<td>2022-01-02</td>
<td>23</td>
<td>3</td>
</tr>
</tbody>
</table>
<p><strong>Order Items</strong></p>
<table class="table">
<thead>
<tr class="header">
<th>item_id</th>
<th>order_id</th>
<th>item</th>
<th>price</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>1</td>
<td>Chocolate</td>
<td>2</td>
</tr>
<tr class="even">
<td>2</td>
<td>1</td>
<td>Twizzler</td>
<td>1</td>
</tr>
<tr class="odd">
<td>3</td>
<td>2</td>
<td>Chocolate</td>
<td>2</td>
</tr>
<tr class="even">
<td>4</td>
<td>2</td>
<td>M and M</td>
<td>1</td>
</tr>
<tr class="odd">
<td>5</td>
<td>3</td>
<td>Twizzler</td>
<td>1</td>
</tr>
<tr class="even">
<td>6</td>
<td>4</td>
<td>Fudge</td>
<td>3</td>
</tr>
<tr class="odd">
<td>7</td>
<td>4</td>
<td>Skittles</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>Using the above tables letâ€™s calculate:</p>
<ul>
<li>total_shipping</li>
<li>total_revenue</li>
</ul>
<p><strong>total_shipping</strong></p>
<pre><code>SELECT
 sum(shipping_cost) AS total_shipping
FROM orders</code></pre>
<table class="table">
<thead>
<tr class="header">
<th>total_shipping</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>8</td>
</tr>
</tbody>
</table>
<p><strong>total_revenue</strong></p>
<pre><code>SELECT
 sum(price) AS total_revenue
FROM items</code></pre>
<table class="table">
<thead>
<tr class="header">
<th>total_revenue</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>11</td>
</tr>
</tbody>
</table>
<p>Looking at the same calculation across the date dimension, we get:</p>
<p><strong>total_shipping by date</strong></p>
<pre><code>SELECT
 order_date,
 sum(shipping_cost) AS total_shipping
FROM â€˜orders.csvâ€™
GROUP BY 1
ORDER BY 1</code></pre>
<table class="table">
<thead>
<tr class="header">
<th>order_date</th>
<th>total_shipping</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2022-01-01</td>
<td>5</td>
</tr>
<tr class="even">
<td>2022-01-02</td>
<td>3</td>
</tr>
</tbody>
</table>
<p><strong>total_revenue by date</strong></p>
<pre><code>SELECT
 order_date,
 sum(price) AS total_revenue
FROM â€˜orders.csvâ€™ AS orders
JOIN â€˜items.cvsâ€™ AS items on
 orders.order_id = items.order_id
GROUP BY 1
ORDER BY 1</code></pre>
<table class="table">
<thead>
<tr class="header">
<th>order_date</th>
<th>total_revenue</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2022-01-01</td>
<td>6</td>
</tr>
<tr class="even">
<td>2022-01-02</td>
<td>5</td>
</tr>
</tbody>
</table>
<p><strong>How does revenue relate to shipping?</strong></p>
<p>This is what we expect:</p>
<table class="table">
<thead>
<tr class="header">
<th>order_date</th>
<th>total_revenue</th>
<th>total_shipping</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2022-01-01</td>
<td>6</td>
<td>5</td>
</tr>
<tr class="even">
<td>2022-01-02</td>
<td>5</td>
<td>3</td>
</tr>
</tbody>
</table>
<p>This is what we get by joining:</p>
<pre><code>SELECT
 orders.order_date,
 sum(items.price) AS total_revenue,
 sum(orders.shipping_cost) AS total_shipping
FROM â€˜orders.csvâ€™ AS orders
JOIN â€˜items.cvsâ€™ AS items ON orders.order_id = items.order_id
GROUP BY 1
ORDER BY 1</code></pre>
<table class="table">
<thead>
<tr class="header">
<th>order_date</th>
<th>total_revenue</th>
<th>total_shipping</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2022-01-01</td>
<td>6</td>
<td><span style="color: amber;">10</span></td>
</tr>
<tr class="even">
<td>2022-01-02</td>
<td>5</td>
<td><span style="color: amber;">5</span></td>
</tr>
</tbody>
</table>
<p>The incorrect results happen because the order rows in the join are duplicated resulting in an overstated computation.</p>
<pre><code>SELECT *
FROM â€˜orders.csvâ€™ orders
LEFT JOIN â€˜items.csvâ€™ AS items ON orders.order_id = items.order_id</code></pre>
<table class="table">
<colgroup>
<col style="width: 11%">
<col style="width: 16%">
<col style="width: 19%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 11%">
<col style="width: 13%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th>order_id</th>
<th>order_date</th>
<th>shipping_cost</th>
<th>user_id</th>
<th>item_id</th>
<th>order_id</th>
<th>item</th>
<th>price</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2022-01-01</td>
<td>2</td>
<td>1</td>
<td>2</td>
<td>1</td>
<td>Twizzler</td>
<td>1</td>
</tr>
<tr class="even">
<td>2</td>
<td>2022-01-01</td>
<td>3</td>
<td>2</td>
<td>4</td>
<td>2</td>
<td>M and M</td>
<td>1</td>
</tr>
<tr class="odd">
<td>3</td>
<td>2022-01-02</td>
<td>1</td>
<td>1</td>
<td>5</td>
<td>3</td>
<td>Twizzler</td>
<td>1</td>
</tr>
<tr class="even">
<td>4</td>
<td>2022-01-02</td>
<td>2</td>
<td>3</td>
<td>7</td>
<td>4</td>
<td>Skittles</td>
<td>1</td>
</tr>
<tr class="odd">
<td>1</td>
<td>2022-01-02</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>Chocolate</td>
<td>2</td>
</tr>
<tr class="even">
<td>2</td>
<td>2022-01-02</td>
<td>3</td>
<td>2</td>
<td>3</td>
<td>2</td>
<td>Chocolate</td>
<td>2</td>
</tr>
<tr class="odd">
<td>4</td>
<td>2022-01-02</td>
<td>2</td>
<td>3</td>
<td>6</td>
<td>4</td>
<td>Fudge</td>
<td>3</td>
</tr>
</tbody>
</table>
</section>
<section id="the-limitations-of-traditional-data-warehousing-and-sql" class="level1">
<h1>The Limitations of Traditional Data Warehousing and SQL</h1>
<section id="sql-templates" class="level2">
<h2 class="anchored" data-anchor-id="sql-templates">SQL Templates</h2>
<p>When using SQL, you will find yourself copying and pasting a lot, building queries with many templates. The issue lies in the fact that we operate in the rectangular context while the graph is network-based.</p>
<p>From the <code>date</code> dimension the <code>total_shipping</code> and <code>total_revenue</code> look like this:</p>
<p><img src="measure_by_date.png" title="Metrics over date dimension" class="img-fluid"></p>
<p>Now, suppose there is another dimension <strong>user</strong> that looks like:</p>
<table class="table">
<thead>
<tr class="header">
<th>user_id</th>
<th>total_revenue</th>
<th>total_shipping</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>4</td>
<td>3</td>
</tr>
<tr class="even">
<td>2</td>
<td>3</td>
<td>3</td>
</tr>
<tr class="odd">
<td>3</td>
<td>4</td>
<td>2</td>
</tr>
</tbody>
</table>
<p>From the <code>user</code> dimension the <code>total_shipping</code> and <code>total_revenue</code> looks like this:</p>
<p><img src="measure_by_user.png" title="Metrics over user dimension" class="img-fluid"></p>
<p>Hence we end up using a lot of query templates which may lead to copy-paste mistakes.</p>
</section>
<section id="data-warehouse-schema-design" class="level2">
<h2 class="anchored" data-anchor-id="data-warehouse-schema-design">Data Warehouse Schema Design</h2>
<p>In trditional data warehousing, we often refer to the <a href="https://en.wikipedia.org/wiki/Star_schema">Star Schema</a>. This involves creating too many fact tables during ETL processes, with the unit of reusability being a table with some dimensionality. But the truth is, reusability should be about the data itself, not its definition.</p>
<p><img src="star_schema.png" title="Example of star schema" class="img-fluid"></p>
<p>The star schema was designed during a time when the databases were slow and the data was relatively big. Another issue with this approach is the lack of real-time data processing. If you produce an intermittent artifact, it wonâ€™t be real time, as these artifacts are produced and then joined later.</p>
</section>
</section>
<section id="introducing-malloy---an-experimental-language-for-data" class="level1">
<h1>Introducing Malloy - An experimental language for data</h1>
<p><a href="https://www.malloydata.dev/">Malloy</a>, a revolutionary language for data, promises to transform the way we handle and view data. It ensures that join relations donâ€™t affect aggregate calculations, fundamentally changing the way we approach data.</p>
<p>In Malloy, data is first described in a network, and the network on joined rectangles forms a reusable object called a <code>source</code>. Aggregate calculations are applied in a query operation, which can reference any â€˜localityâ€™ in the join network to compute results correctly.</p>
<p>The above example in Malloy looks like:</p>
<pre><code>query: table('duckdb:orders.csv') + {
 join_many: items is table('duckdb:order_items.csv')
 on order_id = items.order_id
}
-&gt; {
 group_by: order_date
 aggregate:
 total_revenue is items.price.sum()
 total_shipping is shipping_cost.sum()
order_by: 1
}</code></pre>
<p>which results in this output:</p>
<table class="table">
<thead>
<tr class="header">
<th>order_date</th>
<th>total_revenue</th>
<th>total_shipping</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2022-01-01</td>
<td>6</td>
<td>5</td>
</tr>
<tr class="even">
<td>2022-01-02</td>
<td>5</td>
<td>3</td>
</tr>
</tbody>
</table>
<p>Here,</p>
<pre><code>table('duckdb:orders.csv') + {
 join_many: items is table('duckdb:order_items.csv')
 on order_id = items.order_id
}</code></pre>
<p>is the <strong>SOURCE</strong>. The aggregate calculation,</p>
<pre><code>total_revenue is items.price.sum()</code></pre>
<p>is <em>local to item</em>, and</p>
<pre><code>total_shipping is shipping_cost.sum()</code></pre>
<p>is <em>local to orders</em>.</p>
<p>The above malloy query aggregates along a date dimension, but we can aggregate along any dimension dynamically, simply by updating the dimension as below:</p>
<pre><code>query: table('duckdb:orders.csv') + {
 join_many: items is table('duckdb:order_items.csv')
 on order_id = items.order_id
}
-&gt; {
 group_by: user_id
 aggregate:
 total_revenue is items.price.sum()
 total_shipping is shipping_cost.sum()
order_by: 1
}</code></pre>
<table class="table">
<thead>
<tr class="header">
<th>user_id</th>
<th>total_revenue</th>
<th>total_shipping</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>4</td>
<td>3</td>
</tr>
<tr class="even">
<td>2</td>
<td>3</td>
<td>3</td>
</tr>
<tr class="odd">
<td>3</td>
<td>4</td>
<td>2</td>
</tr>
</tbody>
</table>
<section id="dimensional-freedom" class="level2">
<h2 class="anchored" data-anchor-id="dimensional-freedom">Dimensional Freedom</h2>
<p>Malloy offers the power of â€˜Dimensional Freedomâ€™. This concept allows you to produce results from anywhere in the join network, giving you the flexibility to view your data from different dimensions. The system also deduces a primary key, streamlines it, and formulates the calculation for you.</p>
<section id="source" class="level3">
<h3 class="anchored" data-anchor-id="source">Source</h3>
<ul>
<li>In contrast to traditional SQL, Malloyâ€™s reusability lies in a source.</li>
</ul>
<pre><code>source: orders_items is table('duckdb:orders.csv') + {
 join_many: items is table('duckdb:order_items.csv')
 on order_id = items.order_id
 declare:
 total_revenue is items.price.sum()
 total_shipping is shipping_cost.sum()
}</code></pre>
<ul>
<li>A source can be named, like the above source is named <code>order_items</code>.</li>
<li>The sources describe the join relationships, like the above source describes the relationship between <code>orders</code> and <code>order_items</code></li>
<li>Sources describe both aggregate and scalar calculations.</li>
<li>Source makes queries incredibly simple. For example, performing an aggregate calculation on the above source looks like this in malloy:</li>
</ul>
<pre><code>query: orders_items -&gt; {
 group_by: order_date
 aggregate: total_revenue, total_shipping
 order_by: 1
}</code></pre>
<table class="table">
<thead>
<tr class="header">
<th>order_date</th>
<th>total_revenue</th>
<th>total_shipping</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2022-01-01</td>
<td>6</td>
<td>5</td>
</tr>
<tr class="even">
<td>2022-01-02</td>
<td>5</td>
<td>3</td>
</tr>
</tbody>
</table>
<p>It recognizes that data naturally comes nested, and the need to separate them is an artifact of the SQL engine, not a real-world necessity.</p>
</section>
</section>
</section>
<section id="malloys-features" class="level1">
<h1>Malloyâ€™s Features</h1>
<p>Malloy can query logs straight out of the box, providing a user-friendly interface for data management. It recognizes three types of join:</p>
<ol type="1">
<li>Join_one: for a single item.</li>
<li>Join_many: for multiple items.</li>
<li>Join_cross: for cross joins.</li>
</ol>
<p>But thatâ€™s not all. Malloy also writes nested data and handles non-rectangular data effectively, both in reading and writing. In fact, all Malloy queries read the data only once, which greatly increases efficiency.</p>
<p>Furthermore, Malloy is compatible with a variety of systems, capable of writing queries against <a href="https://cloud.google.com/bigquery/">BigQuery</a>, <a href="https://www.postgresql.org/">PostgreSQL</a>, and <a href="https://duckdb.org/">DuckDB</a>.</p>
<p>Malloy also offers a <a href="https://marketplace.visualstudio.com/items?itemName=malloydata.malloy-vscode">VSCode plugin</a> which is a file of extension <code>.malloy</code> and notebook support which is a file of extension <code>.malloynb</code>. In addition, malloy offers in-built support for charting and visualization which you can learn more about <a href="https://malloydata.github.io/documentation/visualizations/dashboards">here</a>.</p>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>Malloy presents a fresh approach to data management, breaking free from the rectangular confines of traditional SQL and data warehousing. By focusing on dataâ€™s natural network structure, it enables efficient, real-time data operations that can revolutionize the way your business handles and utilizes data.</p>
<p>I reckon this is something remarkable, and I expect to see it being adopted purely because it simplifies the data viewing aspect that will enable domain experts to focus on business logic than on what tables to join. Iâ€™ll be keeping an eye on this project.</p>
<p>Let me know your thoughts!</p>
<p>You can find the link to the notebook <a href="malloy.malloynb">here</a></p>
</section>
<section id="references" class="level1">
<h1>References</h1>
<ul>
<li><a href="https://www.malloydata.dev/docs">Malloy Documentation</a></li>
<li><a href="https://www.youtube.com/watch?v=zmmJgwc3oPI&amp;embeds_referring_euri=https%3A%2F%2Fwww.datacouncil.ai%2F&amp;source_ve_path=Mjg2NjY&amp;feature=emb_logo">Lloyd Tabbâ€™s talk</a></li>
</ul>
<div style="display: flex; justify-content: center;">
<p><a href="https://www.buymeacoffee.com/alephthoughts" target="_blank"> <img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" alt="Buy Me A Coffee" style="height: 60px !important; width: 217px !important;"> </a></p>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://linkedin.com/in/abhisheksharma-/">
      <i class="bi bi-linkedin" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/alephthoughts">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/alephthoughts">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="../../../index.xml">
      <i class="bi bi-rss" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>



</body></html>